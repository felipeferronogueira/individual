<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Climático e Internações</title>

  <style>
    body{
      font-family: Arial, sans-serif;
      background:#f2f2f2;
      margin:0;
    }
    header{
      background:#00695c;
      color:white;
      padding:16px 20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .container{
      max-width:1200px;
      margin:auto;
      padding:20px;
    }

    .info-local{
      text-align:center;
      font-size:0.95rem;
      color:#444;
      margin-bottom:10px;
    }

    /* KPIs */
    .linha-kpi{
      display:flex;
      gap:15px;
      margin-bottom:20px;
    }
    .kpi{
      background:white;
      padding:15px;
      border-radius:8px;
      flex:1;
      box-shadow:0 2px 8px rgba(0,0,0,.1);
    }
    .kpi h3{
      margin:0;
      font-size:0.85rem;
      color:#555;
    }
    .kpi p{
      margin-top:8px;
      font-size:1.3rem;
      font-weight:bold;
    }
    .alto{ color:#b91c1c; }
    .medio{ color:#eab308; }
    .baixo{ color:#15803d; }

    /* Gráficos */
    .grade-graficos{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:15px;
    }
    .card-grafico{
      background:white;
      padding:15px;
      border-radius:8px;
      box-shadow:0 2px 8px rgba(0,0,0,.1);
      min-height:320px;
    }

    /* Legenda */
    .legenda{
      text-align:center;
      margin-top:8px;
      font-size:0.9rem;
      color:#b91c1c;
      font-weight:bold;
    }

    .botao{
      background:#00bfa5;
      color:#003b34;
      border:none;
      padding:10px 14px;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
    }

    .modal{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.5);
      z-index:999;
    }
    .conteudo-modal{
      background:white;
      width:90%;
      max-width:800px;
      margin:5% auto;
      padding:20px;
      border-radius:10px;
    }
    .fechar{
      float:right;
      cursor:pointer;
      font-size:22px;
      font-weight:bold;
    }
  </style>
</head>
<body>

<header>
  <h2>Dashboard Climático e Internações</h2>
  <button id="botaoAbrir" class="botao">Explicação Científica</button>
</header>

<div class="container">

  <div class="info-local">Dados referentes à cidade de <b>São Paulo (SP)</b></div>

  <!-- KPIs -->
  <div class="linha-kpi">
    <div class="kpi">
      <h3>Sugestão de Balanceamento de Carga</h3>
      <p id="kpiBalanceamento">--</p>
    </div>
    <div class="kpi">
      <h3>Risco de Alta Demanda</h3>
      <p id="kpiRisco" class="alto">--</p>
    </div>
    <div class="kpi">
      <h3>Previsão de Internações Respiratórias em SP</h3>
      <p id="kpiPrevisao">--</p>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="grade-graficos">
    <div class="card-grafico">
      <h4>Umidade Mensal</h4>
      <div id="graficoUmidade"></div>
      <div id="legendaUmidade" class="legenda"></div>
    </div>

    <div class="card-grafico">
      <h4>Internações Mensais</h4>
      <div id="graficoInternacoes"></div>
      <div id="legendaInternacoes" class="legenda"></div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modalExplicacao" class="modal">
  <div class="conteudo-modal">
    <span id="btnFechar" class="fechar">&times;</span>
    <h2>Explicação Científica</h2>

    <p><b>Resumo:</b> Ambientes úmidos favorecem vírus e alergênicos, mais internações meses depois.</p>
    <p><b>Seca:</b> Resseca vias aéreas e piora doenças crônicas, porém <u>reduz</u> contágio, correlação negativa.</p>
    <p><b>Umidade:</b> Favorece proliferação de vírus e fungos, internações aumentam com 3 meses de atraso.</p>
    <p>Conclusão: Clima ajuda a prever demanda hospitalar e planejamento de ventiladores.</p>
  </div>
</div>

</body>
</html>

<!-- ApexCharts -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<script>
  const meses = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];

  // Pico de umidade: Julho
  const dadosUmidade = [72, 75, 78, 82, 83, 84, 85, 94, 80, 76, 74, ];

  // Pico de internações: 3 meses depois (Outubro)
  const dadosInternacoes = [300, 320, 330, 350, 420, 480, 500, 520, 540, 550, 700, 400];

  // KPIs
  const umidadeAtual = dadosUmidade.at(-2);
  const risco = "ALTO - Identificado pico de umidade 3 meses atrás";
  const previsaoAlta = dadosInternacoes.at(-3) > 500 ? "ALTA" : "MODERADA";
  const balanceamento = risco == "ALTO - Identificado pico de umidade 3 meses atrás"
    ? "Aumentar quantidade ou desempenho dos ventiladores entre UTI e Enfermarias"
    : "Manter distribuição atual";

  document.getElementById("kpiRisco").innerText = risco;
  document.getElementById("kpiRisco").classList.add(risco.toLowerCase());
  document.getElementById("kpiBalanceamento").innerText = balanceamento;
  document.getElementById("kpiPrevisao").innerText = previsaoAlta;

  // Destacar o mês com maior valor
  const maxUmidade = Math.max(...dadosUmidade);
  const maxInternacoes = Math.max(...dadosInternacoes);
  const mesPicoUmidade = meses[dadosUmidade.indexOf(maxUmidade)];
  const mesPicoInternacoes = meses[dadosInternacoes.indexOf(maxInternacoes)];
  const coresUmidade = dadosUmidade.map(v => v === maxUmidade ? '#b91c1c' : '#00bfa5');
  const coresInternacoes = dadosInternacoes.map(v => v === maxInternacoes ? '#b91c1c' : '#00bfa5');

  // Legendas dinâmicas
  document.getElementById("legendaUmidade").innerText = "Pico do Período: " + mesPicoUmidade;
  document.getElementById("legendaInternacoes").innerText = "Pico do Período: " + mesPicoInternacoes;

  // Gráfico Umidade
  new ApexCharts(document.querySelector("#graficoUmidade"), {
    chart:{ type:"bar" },
    series:[{ name:"Umidade (%)", data:dadosUmidade }],
    xaxis:{ categories:meses },
    colors: coresUmidade
  }).render();

  // Gráfico Internações
  new ApexCharts(document.querySelector("#graficoInternacoes"), {
    chart:{ type:"bar" },
    series:[{ name:"Internações", data:dadosInternacoes }],
    xaxis:{ categories:meses },
    colors: coresInternacoes
  }).render();

  // Modal
  const modal = document.getElementById("modalExplicacao");
  document.getElementById("botaoAbrir").onclick = ()=> modal.style.display = "block";
  document.getElementById("btnFechar").onclick = ()=> modal.style.display = "none";
  window.onclick = e => { if(e.target === modal) modal.style.display="none" }
</script>

